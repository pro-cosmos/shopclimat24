<script>
	function sending_mail() {
		var emailvalid = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
		var email_after = $('#input_email_amigo_after').val();
		var fio_name = $('#input_fio_amigo').val();
		var href = $('#input_href_amigo').val();
		$('.alert-danger').remove();
		if(fio_name == "") {
			$('.dang').append('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ text_placeholder_name }}</div>');
		}
		if(email_after != "")	{
			if(!emailvalid.test(email_after)) {
				$('.dang').append('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ text_error_email }}</div>');
				return false;
			} else {
				$.ajax({
					url: 'index.php?route=extension/module/sendmailamigo/sendmail',
					type: 'post',
					data: 'email=' + $('#input_email_amigo').val() + '&fio=' + $('#input_fio_amigo').val() + '&href=' + encodeURIComponent(window.location.href) + '&captcha=' + $('#input-captcha').val() + '&prod_id={{ product_id }}',
					dataType: 'json',
					success: function(json) {
						if (json['error']) {
							$('.alert-danger').remove();
							if (json['error']['captcha']) {
								$('.dang').append('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['captcha'] + '</div>');
							}
							if (json['error']['fio']) {
								$('.dang').append('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['fio'] + '</div>');
							}
						} else {
							swal(json['success']);
						}
					}
				});
				return false;
			}
		} else {
			$('.dang').append('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ text_empty_email }}</div>');
			$(email_after).focus();
			return false;
		}
	}
	function show_popup_amigo() {
		var emailvalid = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
		var email = $('#input_email_amigo').val();
		if(email != "")	{
			if(!emailvalid.test(email)) {
				swal(
				  '{{ text_error_email }}'
				)
				return false;
			} else {
				
				$('body .divshadow').empty();

				var html_amigo = '';
				html_amigo += '<form method="post">';
				html_amigo += '<div class="option-div">';
				html_amigo += 		'<div class="col-lg-12"><h3 class="col-sm-12 text-center"><i></i>{{ text_h3_amigo }}<i></i></h3></div>';
				html_amigo += 		'<div class="close"><i class="fa fa-times"></i></div>';
				html_amigo += 		'<div class="col-lg-12 col-sm-12"><br />';
				html_amigo += 			'<div class="dang"></div>';
				html_amigo += 			'<div class="form-group required">';
				html_amigo += 				'<div class="input-group">';
				html_amigo += 					'<span class="input-group-addon input_fio_amigo"><i class="fa fa-user"></i></span>';
				html_amigo += 					'<input type="text" value="" placeholder="{{ text_placeholder_name }}" id="input_fio_amigo" name="input_fio_amigo" class="form-control" required>';
				html_amigo += 				'</div><br />';
				html_amigo += 				'<div class="input-group">';
				html_amigo += 					'<span class="input-group-addon input_email_amigo_after"><i class="fa fa-envelope-o"></i></span>';
				html_amigo += 					'<input type="email" value="" placeholder="{{ send_mail_amigo }}" id="input_email_amigo_after" name="input_email_amigo_after" class="form-control">';
				html_amigo += 				'</div>';
				html_amigo += 			'</div>';
				html_amigo += 		'</div>';
				html_amigo += 		'<div class="col-sm-12 margin-bottom">{{ captcha }}</div>';
				html_amigo += 		'<div class="col-sm-12">';
				html_amigo += 			'<button class="btn btn-danger btn-block pull-right" onClick="sending_mail();" data-loading-text="{{ text_upload }}" type="button"><i class="fa fa-envelope-o"></i> {{ button_send }}</button>';
				html_amigo += 		'</div>';
				html_amigo += 		'<div class="clearfix"></div>';
				html_amigo += '</div>';
				html_amigo += '</form>';
				
				setTimeout(function() {
					$('#input_email_amigo_after').attr('value', $('#input_email_amigo').val());
				},0)
				
				bluring();
				if ($('body .divshadow').hasClass("show")) {
					$('body .divshadow').removeClass('show');
				} else {
					$('body .divshadow').addClass('show');
					$('.modal-bg').addClass('show');
				}

				$('body .divshadow').append(html_amigo);
				$('body .divshadow').addClass('col-lg-offset-4 col-lg-4 col-md-offset-3 col-md-6 col-sm-offset-2 col-sm-8 col-xs-offset-1 col-xs-10');
				centering('.divshadow');
				function closedivshadow(){
					$('body .divshadow').removeClass('animated').removeClass('bounceIn').addClass('animated bounceOut');
					setTimeout(function() {
						$('body .divshadow').empty();
						$('body .divshadow').removeClass('show');
						$('.modal-bg').removeClass('show');
						$('body .divshadow').removeClass('cheapering').removeClass('divcart').removeClass('quickpay').removeClass('callbacking').removeClass('reviews_popup').removeClass('col-lg-offset-4 col-lg-4 col-md-offset-3 col-md-6 col-sm-offset-2 col-sm-8 col-xs-offset-1 col-xs-10');
					},700)
				}
				$('body .divshadow .close').click(function() {
					closedivshadow();
				});
			}
		} else {
			swal(
			  '{{ text_empty_email }}'
			)
			$(email).focus();
			return false;
		}
	}
</script>
<div class="col-sm-8 col-xs-9">
	<input id="input_email_amigo" class="form-control margin-right" type="text" value="" placeholder="{{ send_mail_amigo }}" name="input_email_amigo">
</div>
<div class="col-sm-4 col-xs-3 margin-bottom">
	<div class="row-md row-lg">
		<button id="button-send-amigo" class="btn btn-danger btn-block pull-right" onClick="show_popup_amigo();" data-loading-text="{{ text_upload }}" type="button"><i class="fa fa-envelope-o"></i> <span class="hidden-xs">{{ button_send }}</span></button>
	</div>
</div>